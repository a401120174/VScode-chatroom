(window.webpackJsonpf2e_week6=window.webpackJsonpf2e_week6||[]).push([[0],{13:function(e,t,n){e.exports={App:"App_App__1yVFo",rightPart:"App_rightPart__2JT-q",idType:"App_idType__3rBZk",idSet:"App_idSet__2wcim",title:"App_title__2AbAI",confirm:"App_confirm__2v-Rn"}},21:function(e,t,n){e.exports={box:"TextInput_box__1_EKg",textInput:"TextInput_textInput__3XZeP",submit:"TextInput_submit__3KEC5"}},22:function(e,t,n){e.exports={cover:"Popup_cover__DVy-n",hide:"Popup_hide__3fxek",contentBox:"Popup_contentBox__CuinG"}},31:function(e,t,n){e.exports={box:"UserOnlineBar_box__CuKyd"}},34:function(e,t,n){e.exports=n(55)},39:function(e,t,n){},55:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n.n(a),c=n(19),o=n.n(c),s=(n(39),n(13)),i=n.n(s),u=function(){return{type:"GET_FIREBASE"}},l=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return{type:"UPDATE_MSG",msg:e,isAll:t}},m=function(e){return{type:"CHANGE_MSG",msg:e}},p=function(e){return{type:"SET_ID",id:e}},_=function(e){return{type:"OPEN_POPUP",popup:e}},f=function(e){return{type:"UPDATE_ONLINE_USER",count:e}},E=n(12),v=n(15),g=n(8),d=n.n(g),b=function(e){var t=e.name,n=e.msg,a=e.isSelf,c=e.time;return r.a.createElement("div",{className:"".concat(d.a.msgBox," ").concat(a?d.a.isSelf:"")},r.a.createElement("div",{className:d.a.time},r.a.createElement("div",null,c)),r.a.createElement("div",{className:d.a.rightBox},r.a.createElement("div",{className:d.a.msgTag},"<".concat(a?"!--":"").concat(t,">")),r.a.createElement("div",{className:d.a.content},n),r.a.createElement("div",{className:d.a.msgTag},"".concat(a?"--":"</".concat(t),">"))))},O=function(e){var t=e.msg,n=e.userName;e.ChatType;return r.a.createElement("div",{className:d.a.wrapper,id:"content"},r.a.createElement("div",{className:d.a.scrollArea},t.map(function(e,t){return r.a.createElement(b,{name:e.name,msg:e.msg,time:e.time,key:t,isSelf:e.name===n})})))},h=n(21),S=n.n(h),N=function(e){var t=e.onSubmit,n=e.onChangeMsg,c=e.value,o=e.user,s=Object(a.useRef)(null),i=Object(a.useRef)(null);return r.a.createElement("div",{className:S.a.box},r.a.createElement("form",{onSubmit:t},r.a.createElement("span",null,o||"\u4f7f\u7528\u8005"," >"),r.a.createElement("textarea",{ref:s,value:c,onChange:n,className:S.a.textInput,onKeyUp:function(e){"Enter"===e.key&&(e.preventDefault(),i.current.click())}}),r.a.createElement("input",{ref:i,type:"submit",value:"\u9001\u51fa",className:S.a.submit})))},x=n(22),y=n.n(x),T=function(e){var t=e.content,n=e.isOpen;return r.a.createElement("div",{className:"".concat(y.a.cover," ").concat(n?"":y.a.hide)},r.a.createElement("div",{className:y.a.contentBox},t))},w=n(31),C=n.n(w),P=function(e){var t=e.onlineCount;return r.a.createElement("div",{className:C.a.box},r.a.createElement("div",null,"\u7dda\u4e0a\u4eba\u6578:",t,"\u4eba"))};var j=function(e){var t=Object(v.b)(),n=Object(v.c)(function(e){return e}),c=Object(a.useRef)();Object(a.useEffect)(function(){t(u())},[]),Object(a.useEffect)(function(){var e=document.querySelector("#content");e.scrollTop=e.scrollHeight},[n.msg.length]),Object(a.useEffect)(function(){if(n.database){c.current=E.database().ref("msg"),c.current.once("value").then(function(e){var n=[];for(var a in e.val())n.push({name:e.val()[a].name,msg:e.val()[a].msg,time:e.val()[a].time});t(l(n,!0))}),c.current.limitToLast(1).on("value",function(e){for(var n in e.val())t(l({name:e.val()[n].name,msg:e.val()[n].msg,time:e.val()[n].time},!1))});var e=E.database().ref(".info/connected"),a=E.database().ref("user"),r=a.push();e.on("value",function(e){e.val()&&(r.onDisconnect().remove(),r.set(!0))}),a.on("value",function(e){t(f(e.numChildren()))})}},[n.database]);var o=function(){var e=Math.floor(1e3*Math.random());t(p(n.userName||"\u7121\u540d\u6c0f".concat(e))),t(_(""))},s=function(){t(_("SET_ID"))},g=function(e){t(p(e.target.value.trim()))};return r.a.createElement("div",{className:i.a.App},r.a.createElement(T,{content:function(){switch(n.popup){case"SET_ID_TYPE":return r.a.createElement("div",{className:i.a.idType},r.a.createElement("div",{onClick:o},"[\u533f\u540d\u804a\u5929]"),r.a.createElement("div",{onClick:s},"[\u66b1\u7a31\u804a\u5929]"));case"SET_ID":return r.a.createElement("div",{className:i.a.idSet},r.a.createElement("div",{className:i.a.title},"\u66b1\u7a31\u804a\u5929"),r.a.createElement("input",{value:n.userName,onChange:g,placeholder:"\u8f38\u5165\u66b1\u7a31"}),r.a.createElement("div",{onClick:o,className:i.a.confirm},"[\u78ba\u5b9a]"));default:return null}}(),isOpen:!!n.popup}),r.a.createElement("div",{className:i.a.rightPart},r.a.createElement(O,{msg:n.msg,userName:n.userName}),r.a.createElement(P,{onlineCount:n.onlineUser}),r.a.createElement(N,{user:n.userName,onSubmit:function(e){if(e&&e.preventDefault(),0!==n.currentMsg.trim().length){var a=new Date,r=a.getHours(),o=a.getMinutes()<10?"0".concat(a.getMinutes()):a.getMinutes(),s={name:n.userName,msg:n.currentMsg,time:"".concat(r,":").concat(o)},i={};i[E.database().ref().child("posts").push().key]=s,c.current.update(i),t(m(""))}},onChangeMsg:function(e){t(m(e.target.value))},value:n.currentMsg})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var A=n(11),D=n(33),I=n(27),k=n(32);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,a)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(n,!0).forEach(function(t){Object(k.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var U={toggle:!0,roomss:[],database:null,userName:"",msg:[],currentMsg:"",popup:"SET_ID_TYPE",onlineUser:0},G=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"TOGGLE":return M({},e,{toggle:!e.toggle});case"ROOM_FETCH_SUCCEEDED":return M({},e,{rooms:t.rooms});case"GET_FIREBASE_SCS":return M({},e,{database:t.database});case"UPDATE_MSG":return t.isAll?M({},e,{msg:Object(I.a)(t.msg)}):M({},e,{msg:[].concat(Object(I.a)(e.msg),[t.msg])});case"CHANGE_MSG":return M({},e,{currentMsg:t.msg});case"SET_ID":return M({},e,{userName:t.id});case"OPEN_POPUP":return M({},e,{popup:t.popup});case"UPDATE_ONLINE_USER":return M({},e,{onlineUser:t.count});default:return e}},R=n(16),F=n.n(R),L=n(23),H=F.a.mark(K),q=F.a.mark(Z);function K(e){var t;return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={databaseURL:"https://mychatroom-b5909.firebaseio.com"},E.initializeApp(t),e.next=5,Object(L.a)({type:"GET_FIREBASE_SCS",database:!0});case 5:e.next=12;break;case 7:return e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.next=12,Object(L.a)({type:"ROOM_FETCH_FAILED",message:e.t0.message});case 12:case"end":return e.stop()}},H,null,[[0,7]])}function Z(){return F.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(L.b)("GET_FIREBASE",K);case 2:case"end":return e.stop()}},q)}var J=Z,V=Object(D.a)(),X=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||A.c,z=Object(A.d)(G,X(Object(A.a)(V)));o.a.render(r.a.createElement(v.a,{store:z},r.a.createElement(j,null)),document.getElementById("root")),V.run(J),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},8:function(e,t,n){e.exports={wrapper:"Content_wrapper__bG5zf",msgBox:"Content_msgBox__It5Si",time:"Content_time__10qn0",msgTag:"Content_msgTag__33qsS",content:"Content_content__2rcdB",isSelf:"Content_isSelf__ZxC-g",rightBox:"Content_rightBox__2qBZt"}}},[[34,1,2]]]);
//# sourceMappingURL=main.cbe99fff.chunk.js.map